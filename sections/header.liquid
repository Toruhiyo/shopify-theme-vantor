<header class="header" data-header>
  <div class="page-width">
    <div class="header__inner">
      {%- comment -%} Mobile menu toggle {%- endcomment -%}
      <button class="header__icon-btn header__menu-toggle" data-menu-toggle aria-label="{{ 'header.menu' | t }}" style="display:none;">
        {% render 'icon-menu' %}
      </button>

      {%- comment -%} Logo {%- endcomment -%}
      <div class="header__logo">
        <a href="/">
          {%- if section.settings.logo != blank -%}
            <img
              src="{{ section.settings.logo | image_url: width: 200 }}"
              alt="{{ shop.name }}"
              width="200"
              height="40"
              loading="eager"
            >
          {%- else -%}
            {{ shop.name }}
          {%- endif -%}
        </a>
      </div>

      {%- comment -%} Desktop Navigation {%- endcomment -%}
      <nav class="header__nav" role="navigation" aria-label="{{ 'header.navigation' | t }}">
        {%- for link in section.settings.menu.links -%}
          <div class="header__nav-item" {% if link.links.size > 0 %}aria-haspopup="true"{% endif %}>
            <a href="{{ link.url }}" class="header__nav-link {% if link.active %}is-active{% endif %}">
              {{ link.title }}
            </a>

            {%- if link.links.size > 0 -%}
              <div class="mega-menu">
                <div class="page-width">
                  <div class="mega-menu__grid">
                    {%- for child_link in link.links -%}
                      <div class="mega-menu__column">
                        <p class="mega-menu__column-title">{{ child_link.title }}</p>
                        {%- if child_link.links.size > 0 -%}
                          {%- for grandchild_link in child_link.links -%}
                            <a href="{{ grandchild_link.url }}" class="mega-menu__link">{{ grandchild_link.title }}</a>
                          {%- endfor -%}
                        {%- else -%}
                          <a href="{{ child_link.url }}" class="mega-menu__link">{{ 'header.view_all' | t }}</a>
                        {%- endif -%}
                      </div>
                    {%- endfor -%}
                  </div>
                </div>
              </div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </nav>

      {%- comment -%} Quick Links (optional) {%- endcomment -%}

      {%- comment -%} Icons {%- endcomment -%}
      <div class="header__icons">
        <button class="header__icon-btn" data-search-toggle aria-label="{{ 'header.search' | t }}">
          {% render 'icon-search' %}
        </button>

        <a href="{{ routes.account_url }}" class="header__icon-btn" aria-label="{{ 'header.account' | t }}">
          {% render 'icon-account' %}
        </a>

        <button class="header__icon-btn" data-cart-toggle aria-label="{{ 'header.cart' | t }}">
          {% render 'icon-cart' %}
          {%- if cart.item_count > 0 -%}
            <span class="header__cart-count">{{ cart.item_count }}</span>
          {%- endif -%}
        </button>
      </div>
    </div>
  </div>
</header>

{%- comment -%} Mobile Menu {%- endcomment -%}
<div class="mobile-menu" data-mobile-menu aria-label="{{ 'header.mobile_menu' | t }}">
  <div class="mobile-menu__header">
    <span class="header__logo">{{ shop.name }}</span>
    <button class="header__icon-btn" data-menu-close aria-label="{{ 'header.close_menu' | t }}">
      {% render 'icon-close' %}
    </button>
  </div>
  <nav class="mobile-menu__nav">
    {%- for link in section.settings.menu.links -%}
      <a href="{{ link.url }}" class="mobile-menu__link">{{ link.title }}</a>
      {%- if link.links.size > 0 -%}
        {%- for child_link in link.links -%}
          <a href="{{ child_link.url }}" class="mobile-menu__link" style="padding-left: 1rem; font-size: 0.9375rem; color: var(--color-muted-fg);">{{ child_link.title }}</a>
        {%- endfor -%}
      {%- endif -%}
    {%- endfor -%}
  </nav>
</div>

{%- comment -%} Search Overlay {%- endcomment -%}
<div class="search-overlay" data-search-overlay>
  <div class="search-overlay__inner">
    <form action="{{ routes.search_url }}" method="get" role="search">
      <input
        type="search"
        name="q"
        class="search-overlay__input"
        placeholder="{{ 'header.search_placeholder' | t }}"
        autocomplete="off"
        aria-label="{{ 'header.search' | t }}"
      >
    </form>
  </div>
</div>

<style>
  @media (max-width: 989px) {
    .header__menu-toggle { display: flex !important; }
  }
</style>

{% schema %}
{
  "name": "Header",
  "tag": "div",
  "class": "header-section",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Navigation menu",
      "default": "main-menu"
    }
  ]
}
{% endschema %}
