{%- assign menu = section.settings.menu -%}

<header class="header" data-header>
  <div class="header__primary">
    <div class="page-width">
      <div class="header__inner">
        <div class="header__logo">
          <a href="/">
            {%- if section.settings.logo != blank -%}
              <img
                src="{{ section.settings.logo | image_url: width: 200 }}"
                alt="{{ shop.name }}"
                width="200"
                height="40"
                loading="eager"
              >
            {%- else -%}
              {{ shop.name }}
            {%- endif -%}
          </a>
        </div>

        <nav class="header__nav" role="navigation" aria-label="{{ 'header.navigation' | t }}">
          {%- for col in collections -%}
            {%- if col.handle == 'all' or col.products_count == 0 -%}
              {%- continue -%}
            {%- endif -%}

            <div class="header__nav-item" data-nav-mega>
              <a href="{{ col.url }}" class="header__nav-link">
                {{ col.title }}
                <span class="header__nav-chevron">{% render 'icon-chevron' %}</span>
              </a>

              <div class="mega-menu" data-mega-panel>
                <div class="page-width">
                  {% render 'mega-menu-config', col: col %}
                </div>
              </div>
            </div>
          {%- endfor -%}
        </nav>

        <div class="header__icons">
          <button class="header__icon-btn" data-search-toggle aria-label="{{ 'header.search' | t }}">
            {% render 'icon-search' %}
          </button>
          <a href="{{ routes.account_url }}" class="header__icon-btn" aria-label="{{ 'header.account' | t }}">
            {% render 'icon-account' %}
          </a>
          <button class="header__icon-btn" data-cart-toggle aria-label="{{ 'header.cart' | t }}">
            {% render 'icon-cart' %}
            {%- if cart.item_count > 0 -%}
              <span class="header__cart-count">{{ cart.item_count }}</span>
            {%- endif -%}
          </button>
          <button class="header__icon-btn header__menu-toggle" data-menu-toggle aria-label="{{ 'header.menu' | t }}">
            {% render 'icon-menu' %}
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

{%- comment -%} Mobile Menu {%- endcomment -%}
<div class="mobile-menu" data-mobile-menu aria-label="{{ 'header.mobile_menu' | t }}">
  <div class="mobile-menu__header">
    <span class="header__logo">{{ shop.name }}</span>
    <button class="header__icon-btn" data-menu-close aria-label="{{ 'header.close_menu' | t }}">
      {% render 'icon-close' %}
    </button>
  </div>

  <nav class="mobile-menu__nav">
    <a href="/" class="mobile-menu__link">Home</a>

    {%- for col in collections -%}
      {%- if col.handle == 'all' or col.products_count == 0 -%}
        {%- continue -%}
      {%- endif -%}

      <div class="mobile-menu__group" data-mobile-accordion>
        <button class="mobile-menu__link mobile-menu__link--parent" aria-expanded="false" data-mobile-accordion-trigger>
          <span>{{ col.title }}</span>
          <span class="mobile-menu__chevron">{% render 'icon-chevron' %}</span>
        </button>
        <div class="mobile-menu__submenu" data-mobile-accordion-content aria-hidden="true">
          <a href="{{ col.url }}" class="mobile-menu__sublink mobile-menu__sublink--all">Shop All {{ col.title }}</a>
          {% render 'mega-menu-mobile', col: col %}
        </div>
      </div>
    {%- endfor -%}

    <a href="/pages/contact" class="mobile-menu__link">Contact</a>
  </nav>
</div>

{%- comment -%} Search Overlay {%- endcomment -%}
<div class="search-overlay" data-search-overlay>
  <div class="search-overlay__inner">
    <form action="{{ routes.search_url }}" method="get" role="search">
      <input
        type="search"
        name="q"
        class="search-overlay__input"
        placeholder="{{ 'header.search_placeholder' | t }}"
        autocomplete="off"
        aria-label="{{ 'header.search' | t }}"
      >
    </form>
  </div>
</div>


{% schema %}
{
  "name": "Header",
  "tag": "div",
  "class": "header-section",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Navigation menu",
      "default": "main-menu",
      "info": "Primary navigation is auto-generated from your store's collections. This menu is kept for reference."
    }
  ]
}
{% endschema %}
